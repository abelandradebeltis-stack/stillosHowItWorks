<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Manual Fechamento SQL</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- App styles -->
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">

  <div class="container py-3 vh-100 d-flex flex-column">
    <!-- Header -->
    <header class="d-flex align-items-center mb-2 mx-auto" style="max-width:980px;">
      <div class="me-3"  >
        <img src="/stillos-logo.png" alt="STILLOS logo" class="brand-logo" width="72" height="72" />
      </div>
      <div style="display: flex; gap: 1rem;">
        <div>
          <h1 class="h4 mb-0">Manual interativo — Fechamento SQL</h1>
          <small class="text-muted">Procedimentos passo a passo com recursos interativos</small>
        </div>

        <div><a href="../index.html" class="btn btn-sm btn-outline-primary ms-auto">Voltar ao início</a></div>
       
      </div>
      


    </header>

    <!-- Main interactive area -->
    <main class="flex-grow-1 overflow-auto" id="mainArea">
      <div class="accordion" id="manualAccordion">

        <!-- 1 -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
              1. Acesso Inicial e Preparação
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body">
              <p><strong>Conectar à máquina remota</strong></p>
              <ul>
                <li>Fechamento já avançou para o próximo período. É necessário fazer o fechamento SQL manual.</li>
                <li>Conecte à VM / desktop remoto usado para rodar o SQL.</li>
                <li>Ao conectar, sua rede local pode mudar para <code>Stylus.local</code> — é normal.</li>
              </ul>
              <div class="tools">
                <button class="btn btn-sm btn-outline-primary me-2" id="btn-copy-note">Copiar checklist</button>
              </div>
            </div>
          </div>
        </div>

        <!-- 2 -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
              2. Confirmar o Período de Fechamento
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body">
              <p>Confirme o período no arquivo SQL antes de qualquer operação.</p>
              <div class="card p-2 small">
                Ex.: período anterior: <strong>324</strong> → período atual: <strong>325</strong>
              </div>
              <div class="mt-2">
                <label class="form-label">Período atual</label>
                <div class="input-group input-group-sm mb-2">
                  <input id="periodOld" class="form-control form-control-sm" placeholder="324">
                  <input id="periodNew" class="form-control form-control-sm" placeholder="325">
                  <button class="btn btn-sm btn-primary" id="btn-set-period">Salvar</button>
                </div>
                <div id="periodResult" class="small text-success"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- 3 -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
              3. Atualizar Datas no SQL
            </button>
          </h2>
          <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body">
              <ol>
                <li>Abrir arquivo SQL e copiar a data antiga (Ctrl+C).</li>
                <li>Usar ferramenta <strong>Replace</strong> — colar data antiga e nova.</li>
                <li>Clicar em <strong>Replace All</strong>.</li>
                <li>Atualizar o período (ex.: 324 → 325) e salvar.</li>
              </ol>
              <div class="alert alert-warning small">Dica: verifique se o editor aplica DOM/salvamento automático ao fechar.</div>
            </div>
          </div>
        </div>

        <!-- 4 -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingFour">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
              4. Execução dos Blocos SQL
            </button>
          </h2>
          <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body">
              <h6 class="mb-2">4.1 Primeiro SELECT</h6>
              <p class="small">Executar apenas para conferência — não altera dados.</p>

              <h6 class="mt-3 mb-2">4.2 Segundo bloco — SELECT + UPDATE</h6>
              <ol class="small">
                <li>Executar apenas a parte do <code>SELECT</code> (até antes do UPDATE).</li>
                <li>Copiar códigos de pedidos retornados (tipo 1 - venda).</li>
                <li>Colar códigos dentro do <code>IN(...)</code> do UPDATE.</li>
                <li>Executar UPDATE e rodar o SELECT novamente — se zerado, ok.</li>
              </ol>
              <div class="form-inline mt-2">
                <label class="form-label small">Códigos (separe por vírgula)</label>
                <textarea id="codesInput" class="form-control form-control-sm" rows="3" placeholder="377,378,381"></textarea>
                <div class="mt-2">
                  <button id="btn-format-codes" class="btn btn-sm btn-secondary">Formatar para IN(...)</button>
                  <button id="btn-copy-in" class="btn btn-sm btn-primary">Copiar UPDATE</button>
                </div>
                <pre id="previewUpdate" class="mt-2 small bg-white p-2 border rounded" style="display:none;"></pre>
              </div>
            </div>
          </div>
        </div>

        <!-- 5 -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingFive">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive">
              5. Seleções e Updates Intermediários (comissão)
            </button>
          </h2>
          <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body small">
              <p>Após o primeiro UPDATE, há blocos de pré-venda (SIM/NÃO), formas de pagamento e comissões.</p>
              <ul>
                <li>SELECT pré-venda SIM (1) → apenas conferência.</li>
                <li>SELECT pré-venda NÃO (2) → apenas conferência.</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- 6 -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingSix">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix">
              6. UPDATE de Forma de Pagamento e Comissões
            </button>
          </h2>
          <div id="collapseSix" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body">
              <ol class="small">
                <li>Rodar SELECT de forma de pagamento — geralmente muitos códigos.</li>
                <li>Copiar tudo e colar no UPDATE correspondente (usar vírgula + seta para formatar se necessário).</li>
                <li>ValorComissao é calculado com porcentagens da tabela configurada; se estiverem erradas, revisão necessária.</li>
                <li>Executar UPDATE. Atenção: avisos amarelos podem ser ignorados; erros vermelhos exigem correção.</li>
              </ol>
            </div>
          </div>
        </div>

        <!-- 7 -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingSeven">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven">
              7. Códigos que Subtraem 5, 6, 7 e 8 Reais
            </button>
          </h2>
          <div id="collapseSeven" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body small">
              <p>Quando SELECT retorna valores 5 / 6 / 7 / 8 (ou 8.4): separar códigos por grupo.</p>
              <ol>
                <li>Copiar códigos do grupo 5 → colar no UPDATE valor=5.</li>
                <li>Repetir para 6, 7, 8.</li>
                <li>Cole todos os grupos nos respectivos UPDATEs primeiro e depois execute os UPDATEs de cima para baixo.</li>
                <li>Conferência visual: códigos costumam ser sequenciais — facilita ver erros.</li>
              </ol>
            </div>
          </div>
        </div>

        <!-- 8 -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingEight">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEight">
              8. Execução Final
            </button>
          </h2>
          <div id="collapseEight" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body small">
              <ol>
                <li>Executar os UPDATEs (5 → 6 → 7 → 8) um por um.</li>
                <li>Não é necessário revalidar via SELECT; apenas verificar se não há erros vermelhos.</li>
                <li>Ao terminar o último UPDATE, o fechamento SQL está concluído.</li>
              </ol>
            </div>
          </div>
        </div>

        <!-- Fluxograma -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingFlow">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFlow">
              Fluxograma textual do processo
            </button>
          </h2>
          <div id="collapseFlow" class="accordion-collapse collapse" data-bs-parent="#manualAccordion">
            <div class="accordion-body">
              <pre id="flowchart" class="small bg-white p-2 border rounded">
INICIAR
  ↓
Conectar à máquina → Confirmar período (ex.: 325)
  ↓
Abrir arquivo SQL
  ↓
REPLACE datas antigas → novas
  ↓
REPLACE período antigo → novo
  ↓
Selecionar 1º SELECT → Executar (somente visualizar)
  ↓
Selecionar 2º SELECT → Executar → Copiar códigos
  ↓
Montar UPDATE → Executar → Validar (SELECT zerado)
  ↓
Rodar SELECTs de pré-venda (sim/não) → Conferir → Pular
  ↓
SELECT forma de pagamento → Copiar códigos
  ↓
Montar UPDATE com códigos (vírgulas corretas)
  ↓
Executar UPDATE → Se atenção (OK) / Se erro (corrigir)
  ↓
SELECT dos pedidos com comissão variável (valores 5,6,7,8)
  ↓
Separar códigos por grupo (5 → 6 → 7 → 8)
  ↓
Colar códigos em cada UPDATE correspondente
  ↓
Executar updates em ordem (5 → 6 → 7 → 8)
  ↓
Final: Fechamento SQL concluído
              </pre>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-secondary" id="btn-copy-flow">Copiar fluxograma</button>
                <button class="btn btn-sm btn-primary" id="btn-print">Imprimir (fluxograma)</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>

    <!-- actions -->
    <div class="mt-2">
      <div class="d-flex justify-content-end align-items-center small">
        <div>
          <button id="btn-open-all" class="btn btn-sm btn-outline-primary" style="background-color: deeppink; color: white; border: none">Abrir tudo</button>
          <button id="btn-close-all" class="btn btn-sm btn-outline-secondary" style="background-color: deeppink; color: white; border: none">Fechar tudo</button>
        </div>
      </div>
  </div>

      <footer class="mt-3 text-center small manual-footer">
        <p>Documentação interna - Sistemas Stillos - By Beltis tecnologia 2026 © ADS Beltis 2026</p>
  </footer>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
</body>
</html>